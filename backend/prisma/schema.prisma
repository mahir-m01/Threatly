// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../dist/generated"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  id        String    @id @default(cuid())
  name      String
  email     String    @unique
  password  String
  role      String    @default("user")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  projects  Projects[]
}

model Projects {
  id          String                  @id @default(cuid())
  name        String
  link        String
  description String
  status      String                  @default("active") 
  userId      String
  user        Users                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime                @default(now())
  updatedAt   DateTime                @updatedAt
  httpScans   HttpObservatoryScan[]
  sslScans    SSLLabsScan[]
}

model HttpObservatoryScan {
  id           String   @id @default(cuid())
  projectId    String
  project      Projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  grade        String
  score        Int
  testsPassed  Int
  testsFailed  Int
  detailsUrl   String?

  scannedAt    DateTime @default(now())

  @@index([projectId, scannedAt])
}

model SSLLabsScan {
  id          String   @id @default(cuid())
  projectId   String
  project     Projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  grade       String
  hasWarnings Boolean

  supportsTLS13 Boolean
  supportsTLS12 Boolean
  supportsTLS11 Boolean
  supportsTLS10 Boolean

  certIssuer   String?
  certExpires  DateTime?

  vulnHeartbleed Boolean
  vulnPoodle     Boolean
  vulnFreak      Boolean
  vulnLogjam     Boolean
  vulnBeast      Boolean

  hstsEnabled  Boolean

  detailsUrl   String?
  scannedAt    DateTime @default(now())

  @@index([projectId, scannedAt])
}

